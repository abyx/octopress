<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: chef | The Code Dump]]></title>
  <link href="http://www.codelord.net/category/chef/atom.xml" rel="self"/>
  <link href="http://www.codelord.net/"/>
  <updated>2012-03-25T20:33:29+02:00</updated>
  <id>http://www.codelord.net/</id>
  <author>
    <name><![CDATA[Aviv Ben-Yosef]]></name>
    <email><![CDATA[aviv.by+blog@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Why I Regret Choosing RightScale]]></title>
    <link href="http://www.codelord.net/2011/07/27/why-i-regret-choosing-rightscale/"/>
    <updated>2011-07-27T21:10:58+03:00</updated>
    <id>http://www.codelord.net/2011/07/27/why-i-regret-choosing-rightscale</id>
    <content type="html"><![CDATA[<p>A few months ago we had to decide on some framework/environment to use for our devops needs. I've blogged about my experiences with <a href="/2010/12/19/using-puppet-to-automatically-configure-new-ec2-instances/">Puppet</a> and <a href="/2011/03/07/using-chef-to-automatically-configure-new-ec2-instances/">Chef</a> on EC2. Somehow, we eventually ended up using <a href="http://www.rightscale.com">RightScale</a>.</p>

<p>Quick disclaimer: this is not a rant and I don't intend any bashing. It's just a report of my impression from using it.</p>

<p>RightScale provide a system for configuring and managing your cloud infrastructure, from defining how servers are created to monitoring and changing them. RightScale has a few nice features. It has a pretty nice clustering setup of MySQL solution for EC2. It also has decent monitoring and alerting capabilities.</p>

<p>My main problem with it, though, is that they basically took a few steps backwards from all other known solutions, making my life so much harder. I've pointed most if not all of these issues to RightScale on twitter and private emails, yet I can't imagine seeing these issues solved any time soon.</p>

<h4>Scripting (Dis)Abilities</h4>

<p>If you've used Chef or Puppet, you probably got hooked on the ease of managing and creating your own set up scripts. RightScale's solution, RightScripts is a weaker, 1990ish kind of solution:</p>

<ul>
<li>No templates - remember the days you had files with placeholders like <code>@@REPLACE_HERE@@</code> to <code>sed</code> out? Know how nice are real templates in Chef for example, where you can use .erb files? Well, with RightScale it's all gone again. Sed away.</li>
<li>No dependencies - RightScale do have a nice RightScript to install MySQL. Problem is, it depends on a bunch of other scripts and there just isn't any link to it. Install it, hopefully find a reference for dependency name in README. Install dependency. Look for its dependencies. Error prone and tiresome.</li>
<li>Made up version control model - No longer can you use git to update and manage your scripts. RightScale has a dumb-down version control system where you can "commit" changes to scripts you make. These aren't accessible locally on your machine and lack all the nice features of real VCS: can't grep, can't search history. You can't do a <code>git status</code> and see what has changed all over your servers. Chaos.</li>
<li>Scripts are edited in text areas - that's right. That means I'm constantly copying the script from the browser to vim, edit it, copy back and save.</li>
<li>No easy sharing of scripts - with Chef you could download cookbooks from all over the internet. With RightScale you're limited to a closed and pretty empty market of rightscripts.</li>
<li>No composability - say you've got a generic script to attach an EBS volume to a server. Want to attach 2? Thought you can just call the script twice with different parameters? Wrong! You can't. Only option is to copy and paste the script with a new name and new parameter names.</li>
</ul>


<p>Some of these issues might be solved soon, since RightScale seem to be working on enabling use of Chef for scripts. We've tried to set up this beta on our installation but got a lot of exceptions and left it as it is for now.</p>

<h4>Mouse Control</h4>

<p>The UI is centered around clicking way too much. They're pretty nice monitoring dashboard per machine is not configurable. That means that for each and every server we have a routine of doing over a few graphs, clicking and dragging stuff the way we like them. Want to change alert type of a server? Click them all one by one. Need to run a script on all your servers? Click, click, click. This is a painstakingly slow process that makes me feel undervalued each and every time.</p>

<h4>No Automatic Updates</h4>

<p>The beauty of systems like Chef and Puppet is that you can make a change in the configuration and it will automatically get to all of your servers. That's not the case here. You have to go over each server, figure its state and then run the proper scripts.</p>

<h4>Bottom Line</h4>

<p>If you have decent coding ability and know your way around a server, chances are you'd be better off no using RightScale. There's just so much you'll be missing out and a major time waste. I truly hope to see these issues taken cared of, but I think we're far from it.</p>

<p>You should <a href="http://feeds.feedburner.com/TheCodeDump">subscribe</a> to my feed and <a href="http://twitter.com/avivby">follow</a> me on twitter!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using Chef to Automatically Configure New EC2 Instances]]></title>
    <link href="http://www.codelord.net/2011/03/07/using-chef-to-automatically-configure-new-ec2-instances/"/>
    <updated>2011-03-07T21:56:38+02:00</updated>
    <id>http://www.codelord.net/2011/03/07/using-chef-to-automatically-configure-new-ec2-instances</id>
    <content type="html"><![CDATA[<p>This is a follow up post to my <a href="/2010/12/19/using-puppet-to-automatically-configure-new-ec2-instances/">post about using Puppet</a> to get the same result. In the comments to that post I was told by a few people that chef can make my life easier and I decided to give a try. Here's what I came up with.</p>

<p>In this post, as in the previous one, our goal is to be able to start a new EC2 instance with one command, which will in turn be created and started with Apache running.</p>

<p>First of all, instead of having to set up our own server to tell the newly created instances what to do, we are going to use a hosted chef server on Opscode's server. The hosting is free for 5 nodes, and so you can try this out without having to pay them. Go to <a href="http://opscode.com">Opscode's site</a> and register a new user, then also add a new organization.</p>

<p>On our system, we need to start by installing chef. You will also want to install the dependencies needed to make chef talk with EC2 (these are not installed automatically when installing the gem because they're optional):</p>

<p><div><script src='https://gist.github.com/859076.js?file=install.sh'></script>
<noscript><pre><code>gem install chef net-ssh net-ssh-multi fog highline</code></pre></noscript></div>

Now, we need to setup a chef repository. This repository will contain our cookbooks (libraries that contain recipes, which are scripts for doing stuff, like installing apache) and roles (which map recipes to nodes), among other stuff. To get it run:
<div><script src='https://gist.github.com/859076.js?file=clone.sh'></script>
<noscript><pre><code>git clone git://github.com/opscode/chef-repo.git</code></pre></noscript></div>

In the repository create a .chef directory. Now back on Opscode's site, you need to download 3 files: your organization's validator key, your user's key and a generated knife.rb. Once installed, copy them all to the .chef directory:
<div><script src='https://gist.github.com/859076.js?file=cp.sh'></script>
<noscript><pre><code>cp USERNAME.pem ORGANIZATION-validator.pem knife.rb .chef</code></pre></noscript></div>

These will be used by the new instances to connect to Opscode and identify themselves as truly being created by you (this saves us from having to hack an awkward solution for this to work on Puppet).  Add to your knife.rb file your AWS credentials:
<div><script src='https://gist.github.com/859076.js?file=knife.rb'></script>
<noscript><pre><code>knife[:aws_access_key_id]     = &quot;Your AWS Access Key&quot;
knife[:aws_secret_access_key] = &quot;Your AWS Secret Access Key&quot; </code></pre></noscript></div>

We will now fetch the apache2 cookbook, which will allow us to install apache on our instances by adding a single configuration line. To download an existing cookbook, do the following:
<div><script src='https://gist.github.com/859076.js?file=download.sh'></script>
<noscript><pre><code>knife cookbook site vendor apache2</code></pre></noscript></div>

You can see what other cookbooks are made available by looking around <a href="http://github.com/opscode/cookbooks">here</a>. Now, we'll create a role for our instances. Create the file roles/appserver.rb with this data:
<div><script src='https://gist.github.com/859076.js?file=appserver.rb'></script>
<noscript><pre><code>name &quot;appserver&quot;
description &quot;An application server&quot;
run_list(%w{
  recipe[apache2]
})</code></pre></noscript></div>

And to update our Opscode server with the new cookbook and role:
<div><script src='https://gist.github.com/859076.js?file=upload.sh'></script>
<noscript><pre><code>knife cookbook upload apache2
knife role from file roles/appserver.rb</code></pre></noscript></div>

We're getting really close now! You should have a security group define in AWS that has port 22 (SSH) open, for knife to be able to connect to it and configure it, and port 80 (HTTP) for our Apache to be available. I called mine "chef". You will also need to decide with AMI (image) to use, you can find a list of AMIs supplied by Opscode <a href="http://wiki.opscode.com/display/chef/Amazon+EC2+AMIs+with+Chef">here</a>.  And now, to create an instance with one command line, as promised:
<div><script src='https://gist.github.com/859076.js?file=create.sh'></script>
<noscript><pre><code>knife ec2 server create &quot;role[appserver]&quot; --image ami-f0e20899 \
   --groups chef --ssh-user ubuntu --ssh-key my-key</code></pre></noscript></div>
</p>

<p>This will take a while, as knife will create the instance, connect to it, install ruby, chef itself, apache etc. Once it says it has finished simply copy the public DNS of the newly created image (it should be printed once knife finishes) and open it in your browser. My, what a sense of accomplishment one gets from seeing the string "It works!"</p>

<p>I find this a lot easier, cleaner, stream-lined and fun. I'm still learning the ropes with chef, but it has already surprised by being easy to change, being completely git-integrated and by Opscode's fast support (even for non-paying customers). You can dig further <a href="http://wiki.opscode.com/display/chef/Quick+Start">in</a> <a href="http://wiki.opscode.com/display/chef/Launch+Cloud+Instances+with+Knife">these</a> <a href="http://help.opscode.com/kb/start/how-to-get-started">links</a>.</p>

<p>You should <a href="http://feeds.feedburner.com/TheCodeDump">subscribe</a> to my feed and <a href="http://twitter.com/avivby">follow</a> me on twitter!</p>
]]></content>
  </entry>
  
</feed>
