
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>DRY: Don't Get Trigger Happy - The Code Dump</title>
  <meta name="author" content="Aviv Ben-Yosef">

  
  <meta name="description" content="Once you&#8217;ve started to assimilate DRY into your regular routine, it usually becomes addictive. The feedback loop constructed of removing moving &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.codelord.net/2010/11/04/dry-dont-get-trigger-happy">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/TheCodeDump" rel="alternate" title="The Code Dump" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-7925779-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">The Code Dump</a></h1>
  
    <h2>A place a coder rants at...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/TheCodeDump" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.codelord.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">DRY: Don't Get Trigger Happy</h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-04T20:11:38+02:00" pubdate data-updated="true">Nov 4<span>th</span>, 2010</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Once you&#8217;ve started to assimilate DRY into your regular routine, it usually becomes addictive. The feedback loop constructed of removing moving parts, making stuff clearer and reducing chances of error simply gets you into a certain rhythm that&#8217;s hard to get enough of.</p>

<p>The problem is, that as with any skill, you have to learn to master even the corner cases and not just blindly follow a mantra. Following a mantra is good enough for starting everything, but there comes a time you have to experience and understand for yourself when using a rule of thumb is a good idea and when it isn&#8217;t. So, let&#8217;s now talk about the &#8216;Ha&#8217; part of the <a href="http://en.wikipedia.org/wiki/Shuhari">ShuHaRi</a> cycle in DRY.</p>

<p>We know that duplicate code is a code smell and a DRY violation that needs to be removed. But, as with any rule, it has exceptions. Taking the dumb example, look at this piece of code:</p>

<div><script src='https://gist.github.com/662843.js?file='></script>
<noscript><pre><code>for (int i = 0; i &lt; array.lenth; i++)
    if (array[i] == 0)
        bad_ones++;</code></pre></noscript></div>


<p>In the snippet above you can see the value &#8216;0&#8217; referenced twice. Is that a DRY violation? I&#8217;m sure you&#8217;ll agree it isn&#8217;t. After all, even though it is the same value that appears multiple times syntacticly, it has a different meaning semantically. The first zero is an initialization value and the other seems to indicate bad values in the array. The fact that they both are zero is meaningless and a coincidence. It might very well be that the next version will mark bad values as &#8216;null&#8217;, which surely shouldn&#8217;t change the way the array index is initialized.  OK, so that was an easy one. Let&#8217;s look at this next snippet, taking from some code whipped up solve the Game of Life:</p>

<div><script src='https://gist.github.com/662849.js?file='></script>
<noscript><pre><code>if cell.is_alive? and cell.neighbours in (2,3) then
    cell.stay_alive
elsif cell.is_dead? and cell.neighbours == 2 then
    cell.live!
end</code></pre></noscript></div>


<p>In that example, 2 appears twice also. Is that a DRY violation? After being in a <a href="/2010/05/10/notes-from-the-first-israeli-code-retreat/">code retreat</a>, and hearing from other code retreaters, I understand that many people that try and focus on DRY think that is in fact a DRY violation. After all, both occurrences refer to the number of living neighbours a cell has and the number is part of the rules of the problem domain. But, let&#8217;s give this a bit more thought. Although both instances of 2 reference a rule of the game, they reference <em>different</em> rules of the game. Semantically, they are different. If we decide to change the minimal number of neighbours for a cell to stay alive it does not mean we will want to change the number of neighbours it takes to bring a cell to life.</p>

<p>I hope you&#8217;re catching my train of thought here. Now let&#8217;s look at another example. This is a snippet of code one might get to while doing the famous Bowling Kata:</p>

<div><script src='https://gist.github.com/662853.js?file='></script>
<noscript><pre><code>if rolls[frameIndex] == 10:
    score += rolls[frameIndex] + rolls[frameIndex + 1] + rolls[frameIndex + 2]
    frameIndex++
elif rolls[frameIndex] + rolls[frameIndex + 1] == 10:
    score += rolls[frameIndex] + rolls[frameIndex + 1] + rolls[frameIndex + 2]
    frameIndex += 2
else:
    score += rolls[frameIndex] + rolls[frameIndex + 1]
    frameIndex += 2</code></pre></noscript></div>


<p>This snippet adds the current frame&#8217;s score to the total score of the bowling game, taking into account whether the frame has a strike, a spare, or is a &#8216;simple&#8217; frame. Now, you might notice there is some &#8220;duplication&#8221; here. I can tell you that when I started refactoring this code to make it look better, I had to think a bit whether the calculation of the score in the first branch and the second branch should be extracted to be the same method.
 But again, this is a mere textual duplication, and not a violation of real DRY, which is duplication of <em>intent</em>. The first one takes the score of the strike frame itself and adds the strike bonus (2 next rolls), the other takes the score of the spare frame and adds the spare bonus (1 next roll), so even though it takes the same additions, it is not the same logic. The better way is of course this:</p>

<div><script src='https://gist.github.com/662854.js?file='></script>
<noscript><pre><code>if isStrike(frameIndex):
    score += FULL_FRAME_SCORE + strikeFrameBonus(frameIndex)
    frameIndex++
elif isSpare(frameIndex):
    score += FULL_FRAME_SCORE + spareFrameBonus(frameIndex)
    frameIndex += 2
else:
    score += frameScore(frameIndex)
    frameIndex += 2

def strikeFrameScore(i): return rolls[i + 1] + rolls[i + 2]
def spareFrameScore(i): return rolls[i + 2]
</code></pre></noscript></div>


<p>This is a tricky one, and if you noticed it before reading give yourself a pat on the back! If you start and refactor this with an IDE, most IDEs will actually make a bit of a mess for you here, because they usually try and replace same occurrences of code once you extract a method, but here that would not be the better choice. Always keep an eye on your refactoring tools, because they, unlike you, can&#8217;t tell the difference between syntactic duplication and semantic duplication!</p>

<p>The big money of DRY comes when you learn to tell the difference between duplication of intent and mere duplication of text. This simple rule for judging your code helps you understand your code better, simply by making you actively consider what your real intention is.</p>

<p>I&#8217;ve written more about DRY <a href="/2010/11/03/taking-dry-further/">here</a> and <a href="/2010/11/02/short-intro-to-dry/">here</a> if you&#8217;d like to hear more.</p>

<p>You should subscribe to my <a href="http://feeds.feedburner.com/TheCodeDump">feed</a> and follow me on <a href="http://twitter.com/avivby">twitter</a>!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Aviv Ben-Yosef</span></span>

      








  


<time datetime="2010-11-04T20:11:38+02:00" pubdate data-updated="true">Nov 4<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='/category/dry/'>DRY</a>, <a class='category' href='/category/programming/'>Programming</a>, <a class='category' href='/category/clean-code/'>clean code</a>, <a class='category' href='/category/pragprowrimo2010/'>pragprowrimo2010</a>, <a class='category' href='/category/software-craftsmanship/'>software craftsmanship</a>
    
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.codelord.net/2010/11/04/dry-dont-get-trigger-happy/" data-via="avivby" data-counturl="http://www.codelord.net/2010/11/04/dry-dont-get-trigger-happy/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2010/11/03/taking-dry-further/" title="Previous Post: Taking DRY Further">&laquo; Taking DRY Further</a>
      
      
        <a class="basic-alignment right" href="/2010/11/06/refactoring-youre-doing-it-wrong/" title="Next Post: Refactoring: You're Doing it Wrong">Refactoring: You're Doing it Wrong &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Aviv Ben-Yosef</h1>
  <img src="https://api.twitter.com/1/users/profile_image?screen_name=avivby&amp;size=original" width="128" height="128" style="height: 128px; width: 128px; border-radius: 6px">
  <p>An aspiring software craftsman and a happy hacker. More <a href="/about">about me</a>.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/03/07/slides-from-the-how-billguard-does-mongodb-talk/">Slides from the "How BillGuard does MongoDB" Talk</a>
      </li>
    
      <li class="post">
        <a href="/2012/03/01/notes-from-the-agile-practitioners-2012-improving-your-tdd-workshop/">Notes from the Agile Practitioners 2012 Improving Your TDD Workshop</a>
      </li>
    
      <li class="post">
        <a href="/2012/02/28/notes-from-the-israeli-software-craftsmanship-group-code-retreat/">Notes from the Israeli Software Craftsmanship Group Code Retreat</a>
      </li>
    
      <li class="post">
        <a href="/2012/02/04/extend-your-toolbox-custom-matchers/">Extend Your Toolbox: Custom Matchers</a>
      </li>
    
      <li class="post">
        <a href="/2012/01/28/stop-bitching-do-self-agile/">Stop Bitching: Do Self-Agile</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("avivby", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/avivby" class="twitter-follow-button" data-show-count="false">Follow @avivby</a>
  
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Aviv Ben-Yosef -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'codelord';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.codelord.net/2010/11/04/dry-dont-get-trigger-happy/';
        var disqus_url = 'http://www.codelord.net/2010/11/04/dry-dont-get-trigger-happy/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
