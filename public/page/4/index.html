
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>The Code Dump</title>
  <meta name="author" content="Aviv Ben-Yosef">

  
  <meta name="description" content="Fake it till you make it is a known pattern in Test Driven Development implementation, which means one writes code that acts like it knows what it&# &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.codelord.net/page/4">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/TheCodeDump" rel="alternate" title="The Code Dump" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-7925779-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">The Code Dump</a></h1>
  
    <h2>A place a coder rants at...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/TheCodeDump" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.codelord.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/03/05/fake-it-till-you-make-it-team-edition/">Fake It Till You Make It - Team Edition</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-03-05T10:34:10+02:00" pubdate data-updated="true">Mar 5<span>th</span>, 2011</time>
        
         | <a href="/2011/03/05/fake-it-till-you-make-it-team-edition/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://c2.com/cgi/wiki?FakeItUntilYouMakeIt">Fake it till you make it</a> is a known pattern in Test Driven Development implementation, which means one writes code that acts like it knows what it&#8217;s doing in order to know what it&#8217;s doing. This is a powerful technique and I&#8217;ve <a href="/2010/08/20/unleashing-your-enthusiasm-grunts-making-a-change/">already written</a> how using the same trick on the individual scale can help you make your team better.</p>

<p>I just recently realized that I had already seen this principle applied to a whole team which then caused a whole department to follow suit.</p>

<p>Back in 2005, I had the luck to join a particularly interesting team. Hanging around the section the team was part of clearly showed that all other teams regard that specific team (let&#8217;s call it A Team) as a highly skilled team. People said they were the XP (Extreme Programming) team, and were generally looked at as an example of how a good team should work.</p>

<p>After joining the team I got a look from the inside of what was really going on. All the developers were highly talented, but being &#8220;The XP Team&#8221;? Hah! 2 guys have read Kent Beck&#8217;s (amazingly awesome) <a href="http://www.amazon.com/gp/product/0321278658?ie=UTF8&amp;tag=thcodu02-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0321278658">Extreme Programming Explained</a><img src="http://www.assoc-amazon.com/e/ir?t=thcodu02-20&l=as2&o=1&a=0321278658" style="width: 0; height: 0; display: none; border: none !important;"> and simply started pairing and writing automated unit tests before the code.</p>

<p>Simply starting with those 2 small parts of the XP way of doing things got them improved results which then got the rest of the section interested. By simply saying they were going to try that XP thing and saying it made their lives better, the A Team got the ball rolling for the whole section without never even trying to start an Agile Transition.</p>

<p>And this wasn&#8217;t a one trick poney! About 2 years later, the same thing happened with Scrum. One teammate read a <a href="http://www.amazon.com/gp/product/1430322640?ie=UTF8&amp;tag=thcodu02-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=1430322640">good intro</a><img src="http://www.assoc-amazon.com/e/ir?t=thcodu02-20&l=as2&o=1&a=1430322640" style="width: 0; height: 0; display: none; border: none !important;"> to it (back when it was still a free PDF), told the rest of the team which then decided to give a try. After a few sprints of seeing how organized standup meetings and the like actually helped our process we decided to keep it.</p>

<p>We didn&#8217;t try to &#8220;get everyone to realize this is the best way&#8221;. Some people happened to come inside our room during standups, or see the scrum board. Those alone got people interested and from then on again, A Team got the section to advance nicely.</p>

<p>This is a marvelous story that I only now realize how rare it is. Simply because the team looked to the rest of the section like they knew what they were doing it got all of them to try agile without having to break down walls or bust open doors. Sometimes just doing what feels right is enough.</p>

<p>Fake it till you make it is just another way of saying &#8220;If you build it they will come&#8221;!</p>

<p>You should <a href="http://feeds.feedburner.com/TheCodeDump">subscribe</a> to my feed and <a href="http://twitter.com/avivby">follow</a> me on twitter!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/02/22/you-owe-it-to-yourself-to-be-old-school/">You Owe it to Yourself to be Old-School</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-02-22T07:33:46+02:00" pubdate data-updated="true">Feb 22<span>nd</span>, 2011</time>
        
         | <a href="/2011/02/22/you-owe-it-to-yourself-to-be-old-school/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I love watching House. My favorite episodes are those where he manages to debug an illness not by knowing an obscure desease, but by having the holistic knowledge of how the body works and thus being able to deduce the real problem.</p>

<p>I find this correlates very much to a set of tools and knowledge a lot of coders are missing that has tremendous value. Joel Spolsky <a href="http://www.joelonsoftware.com/articles/CollegeAdvice.html">wrote years ago</a> that developers should learn C in order to have a thorough understanding of their environment. I actually think this should be taken a few notches further.</p>

<p>Learn C and some systems programming and you have the ability to grasp basics of most tools you use. How can you spot and truly understand memory leaks without having to manage memory allocation by yourself?</p>

<p>What would you do if some code you wrote or application you use suddenly simply blurts out it has a connection error? Or the Apache server you&#8217;re installing is acting up on you? My #1 power tool for these situations is simply opening wireshark and look at what goes through my wire. Learn the basics of TCP/IP and you&#8217;ll be able to debug most network problems swiftly.</p>

<p>And don&#8217;t get me started on using the shell. No matter what you think, having shell-fu pays off daily. Any text manipulation you&#8217;re thinking of, most simple processing tasks - you can whip up a oneliner to do it in less time than most IDEs take to start up.</p>

<p>And the reasons just go on and on. Reading important functions from the Linux kernel will help you understand why Java suddenly won&#8217;t fork child processes. Knowing how known security issues work (injections, buffer overflows, etc.) is the only way for you to catch security mistakes at the drawing-on-the-board stage and not at the shit-the-DB-is-stolen stage.</p>

<p>I don&#8217;t care if you&#8217;re doing Rails and never need to see the outside of a pointer. There&#8217;s nothing like having the holistic grasp of things to help you solve problems quickly, a-la Dirk Gently. All these points I&#8217;ve made in this post? All real problems solved in the last couple of months with some old-school chops.</p>

<p>Do yourself good - read <a href="http://www.amazon.com/gp/product/0131103628?ie=UTF8&amp;tag=thcodu02-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0131103628">K&amp;R</a><img src="http://www.assoc-amazon.com/e/ir?t=thcodu02-20&l=as2&o=1&a=0131103628" style="width: 0; height: 0; display: none; border: none !important;"> for some C understanding. Read the first chapters of <a href="http://www.amazon.com/gp/product/0201633469?ie=UTF8&amp;tag=thcodu02-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0201633469">TCP/IP Illustrated</a><img src="http://www.assoc-amazon.com/e/ir?t=thcodu02-20&l=as2&o=1&a=0201633469" style="width: 0; height: 0; display: none; border: none !important;">. Read <a href="http://www.amazon.com/gp/product/0672329468?ie=UTF8&amp;tag=thcodu02-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0672329468">Linux Kernel Development (3rd Edition)</a><img src="http://www.assoc-amazon.com/e/ir?t=thcodu02-20&l=as2&o=1&a=0672329468" style="width: 0; height: 0; display: none; border: none !important;"> for a nice walk-through of the interesting parts. This knowledge won&#8217;t get obsolete anytime soon. Can you say that about your favorite framework?</p>

<p>You should <a href="http://feeds.feedburner.com/TheCodeDump">subscribe</a> to my feed and <a href="http://twitter.com/avivby">follow</a> me on twitter!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/02/05/stop-wasting-my-code/">Stop Wasting My Code</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-02-05T19:27:12+02:00" pubdate data-updated="true">Feb 5<span>th</span>, 2011</time>
        
         | <a href="/2011/02/05/stop-wasting-my-code/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>During my service in the army I had the opportunity to move around some electronic equipment from place to place. A lot of it was pretty old (and by that I mean it predates me), but worked perfectly where it was. We had systems running for decades without a problem, but once we unplugged them and moved them to a different room they went dead.</p>

<p>Over time we&#8217;ve identified this phenomenon and simply noted that things that aren&#8217;t in use stop functioning. It used to puzzle me, but eventually I came to accept this. What still is hard for me to accept though, is the fact that this is exactly the same with software as it is with hardware, if not worse.</p>

<p>I thought I learned this lesson a few years ago, after reading the <a href="http://www.amazon.com/gp/product/020161622X?ie=UTF8&amp;tag=thcodu02-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=020161622X">Pragmatic Programmer</a><img src="http://www.assoc-amazon.com/e/ir?t=thcodu02-20&l=as2&o=1&a=020161622X" style="width: 0; height: 0; display: none; border: none !important;"> and having it hammer YAGNI and KISS to my head, but I keep getting surprised every time I find out that I&#8217;ve just done it again.</p>

<p>Actually, learning Git has made this problem rear its ugly head again. Git makes it easy to write up some code and then keep it somewhere. I&#8217;d either stash some changes or keep a side branch with some work I started. The really bad part is adding this code to production code, simply because it&#8217;s there. The problem is that <em>code gets stale</em> if it&#8217;s not really used, and fast.</p>

<p>I can&#8217;t think of a single case where we added code before it was actually needed and got something good out of it. Fact is, every line of code you write before there&#8217;s a real use case or actual need for is just you guessing. And we&#8217;re mostly guessing anyway about stuff we actually need to get done, so why add more ambiguity in there?</p>

<p>As I read in <a href="http://www.amazon.com/gp/product/0321503627?ie=UTF8&amp;tag=thcodu02-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0321503627">Growing Object-Oriented Software</a><img src="http://www.assoc-amazon.com/e/ir?t=thcodu02-20&l=as2&o=1&a=0321503627" style="width: 0; height: 0; display: none; border: none !important;"> code isn&#8217;t sacred simply because it&#8217;s there, and it won&#8217;t take as long to write it again if you&#8217;ll need to. Don&#8217;t be afraid to delete code that isn&#8217;t actually needed just because you put two hours in it. The time you&#8217;ll spend maintaining it will take much more.</p>

<p>This is exactly the Lean definition of <em>Waste</em> - everything not adding value to customers, and adding code just for you to feel better isn&#8217;t helping your customers. I now consider waste as one of my sworn enemies. At my work I&#8217;ve decided to take on myself the role of do-we-really-need-that dude. It means being a PITA sometimes, but it pays off tenfold.</p>

<p>Next time you feel tempted to commit that code you&#8217;re not sure you&#8217;ll need anymore, keep in mind the best code is no code.</p>

<p>You should subscribe to <a href="http://feeds.feedburner.com/TheCodeDump">my feed</a> and follow me on <a href="http://twitter.com/avivby">twitter</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/01/10/book-review-growing-object-oriented-software/">Book Review: Growing Object-Oriented Software</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-10T23:46:42+02:00" pubdate data-updated="true">Jan 10<span>th</span>, 2011</time>
        
         | <a href="/2011/01/10/book-review-growing-object-oriented-software/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.amazon.com/gp/product/0321503627?ie=UTF8&amp;tag=thcodu02-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0321503627"><img src="/images/posts_images/goos.jpg" style="float: right;"/></a></p>

<blockquote><p>Starting with a test means that we have to describe <strong>what</strong> we want to achieve before we consider <strong>how</strong>.</p></blockquote>

<p>2010, for me, was a year with quite a good reading list. It was when I first got to read some really good books such as Clean Code, Agile Software Development, TDD by Example and  Apprenticeship Patterns. These are all stellar books I highly recommend.</p>

<p>Yes, indeed it was an awesome year and yet I can tell you that the best book I read this year is <a href="http://www.amazon.com/gp/product/0321503627?ie=UTF8&amp;tag=thcodu02-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0321503627">Growing Object-Oriented Software, Guided by Tests</a><img src="http://www.assoc-amazon.com/e/ir?t=thcodu02-20&l=as2&o=1&a=0321503627" style="width: 0; height: 0; display: none; border: none !important;"> (GOOS, for short).</p>

<p>I actually never heard of the authors before 2010. As opposed to books by authors such as Kent Beck and Robert Martin which one regularly hears about, I was quite astonished that I kept hearing about this book in different places.</p>

<p>I heard talks mention it, I saw lots of tweets about it and quite a few people that I highly value were praising it. This picked my interest and boy, am I glad I decided to add it to my pile.</p>

<p>I&#8217;ve read a lot about better development, better testing and better everything. And yet, I&#8217;ve never come across a book as thourough and as comprehensive as GOOS. If you read <a href="/2010/06/15/book-review-clean-code/">my</a> <a href="/2010/05/02/agile-software-development-you-will-never-code-the-same-again/">other</a> <a href="/2010/01/12/every-coder-should-read-tdd-by-example/">reviews</a> you will see that what usually buys me over are good code walk-throughs. Now let me tell you, you haven&#8217;t seen a good walk-through until you&#8217;ve seen GOOS.</p>

<blockquote><p>Code isn&#8217;t sacred just because it exists, and the second time won&#8217;t take as long.</p></blockquote>

<p>On the one hand, the book is loaded with practical tips for making your tests better, faster, more readable and maintainable. It covers the nuances of testing ORM systems, GUIs, multi-threading problems and more.</p>

<p>On the other hand, every page turn is greeted with more nuggets of OOP lore. Actually, seeing all this wisdom clustered so tightly by people that have been struggling with these problems for over a decade now seems illegal to me. Are we really allowed to learn so many secrets of the profession this fast? Surely some sort of blood sacrifice has to be made?</p>

<blockquote><p>Once we start a major rework we can&#8217;t stop until finished. There&#8217;s a reason surgeons prefer keyhole surgery to opening up a patient.</p></blockquote>

<p>I&#8217;ve read GOOS over the course of a few months, consuming chapters little by little and letting the knowledge sink in. I was amazed at how much this affected my way of thinking about OOP and TDD, pretty much right off the covers. I already <a href="/2010/12/18/adding-goos-sauce-to-gwt-mvp/">blogged</a> about how my new OOP-Spidey-Sense helped us improve our architecture.</p>

<p>I&#8217;ll finish with saying this book is a game-changer for me, even though I&#8217;ve been doing TDD for a few years now. To the authors, Nat and Steve, I take my hat off. They have earned a place of honor in my <a href="http://twitter.com/#!/avivby/deserve-a-beer">Deserve-A-Beer list</a>.</p>

<p>And to sum up all these great quotes from GOOS, here&#8217;s another gem:</p>

<blockquote><p>The last thing we should have to do is crack open the debugger and step through the tested code to find the point of disagreement.</p></blockquote>

<p>You should subscribe to my <a href="http://feeds.feedburner.com/TheCodeDump">feed</a> and follow me on <a href="http://twitter.com/avivby">twitter</a>!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/12/19/using-puppet-to-automatically-configure-new-ec2-instances/">Using Puppet to Automatically Configure New EC2 Instances</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-19T22:30:48+02:00" pubdate data-updated="true">Dec 19<span>th</span>, 2010</time>
        
         | <a href="/2010/12/19/using-puppet-to-automatically-configure-new-ec2-instances/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><em>Note: I posted an update about doing the same with chef <a href="/2011/03/07/using-chef-to-automatically-configure-new-ec2-instances/">here</a>.</em></p>

<p>This is a quickie techie post that summarizes a few hours of learning that I wish someone else had put up on the web before me. I assume some knowledge about Puppet, and recommend the <a href="http://www.amazon.com/gp/product/1430230576/ref=as_li_tf_tl?ie=UTF8&amp;tag=thcodu02-20&amp;linkCode=as2&amp;camp=217145&amp;creative=399381&amp;creativeASIN=1430230576">Pro Puppet</a><img src="http://www.assoc-amazon.com/e/ir?t=thcodu02-20&l=as2&o=1&a=1430230576&camp=217145&creative=399381" style="width: 0; height: 0; display: none; border: none !important;"> book and heard good stuff about <a href="http://www.amazon.com/gp/product/1849515387/ref=as_li_ss_tl?ie=UTF8&amp;tag=thcodu02-20&amp;linkCode=as2&amp;camp=1789&amp;creative=390957&amp;creativeASIN=1849515387">Puppet 2.7 Cookbook</a><img src="http://www.assoc-amazon.com/e/ir?t=thcodu02-20&l=as2&o=1&a=1849515387" style="width: 0; height: 0; display: none; border: none !important;">.</p>

<p>So, I wanted to be able to configure via Puppet the way our new instances should be configured, and then be able to easily spawn new instances that will get configured by said puppet. The first part is <a href="https://help.ubuntu.com/10.10/serverguide/C/puppet.html">installing</a> puppetmaster. I decided to manually setup an EC2 instance that will act as the puppet master:</p>

<div><script src='https://gist.github.com/747614.js?file=install_master.sh'></script>
<noscript><pre><code>aptitude install puppetmaster
echo &quot;127.0.0.1 puppet&quot; &gt;&gt; /etc/hosts</code></pre></noscript></div>


<p>Under /etc/puppet/manifests/site.pp we place the &#8220;main&#8221; entry point for the configuration. This is the file that is responsible for including the rest of the files. I copied the structure from somewhere where the actual classes were put under /etc/puppet/manifests/classes and import it in site.pp. Do note that currently this setup only supports a single type of node, but supporting more should be doable using <a href="http://docs.puppetlabs.com/guides/external_nodes.html">external nodes</a> to classify the node types.</p>

<div><script src='https://gist.github.com/747614.js?file=site.pp'></script>
<noscript><pre><code>import &quot;classes/*&quot;

node default {
        include default_node
}</code></pre></noscript></div>




<div><script src='https://gist.github.com/747614.js?file=classes/default_node.pp'></script>
<noscript><pre><code>class default_node {
  package { 'apache2':
    ensure =&gt; installed
  }
  service { 'apache2':
    ensure =&gt; true,
    enable =&gt; true,
    require =&gt; Package['apache2'],
  }
}</code></pre></noscript></div>


<h2>Auto-signing new instances</h2>

<p>A common problem with puppet setups is that whenever a new puppet connects to the puppet master it hands it a certificate which you then have to automatically sign before the puppetmaster will agree to configure it. This is problematic in setups like mine where I want to be able to spawn new instances with a script and don&#8217;t hassle with jumping between the machines right after the certificate was sent and approving it. I found two ways to circumvent this:</p>

<h3>1. Simply auto-signing everything and relying on firewalls</h3>

<p>In case you can allow yourself to firewall the puppetmaster port (tcp/8140) to be only accessible to trusted instances, you do not actually need to sign the certificates, you can tell puppet to trust whatever it gets and leave the security in the hands of your trusty firewall. With EC2 this is extremely easy:</p>

<ul>
<li>Setup a security group, I&#8217;ll call mine &#8220;puppets&#8221;</li>
<li>Add a security exception to the puppetmaster that allows access to all instances in the &#8220;puppets&#8221; group</li>
<li>Create all puppet instances in the &#8220;puppets&#8221; security group</li>
<li>Configure puppet to automatically sign all requests: echo &#8220;*&#8221; > /etc/puppet/autosign.conf</li>
</ul>


<p>I decided to go with this solution since it&#8217;s simpler and less likely to get broken. I didn&#8217;t see it documented anywhere else. The downside is that you&#8217;ve got to have your puppetmaster on EC2 too.</p>

<h3>2. Automatically identifying new instances and adding them</h3>

<p>This is a solution I saw mentioned a few times online. Using the <a href="http://aws.amazon.com/developertools/351?_encoding=UTF8&amp;jiveRedirect=1">EC2 API tools</a> write a script that gets the DNS names of all the trusted instances you&#8217;ve got and write them. Once you have this getting it to run with a cron job every minute will do the trick. This can be done with sophisticated scripts, but for my (<em>very initial</em>) testing, this seemed to work:</p>

<div><script src='https://gist.github.com/747614.js?file=cron'></script>
<noscript><pre><code>* * * * * ec2-describe-instances | grep ^INSTANCE  | awk '{print $4}' &gt; /etc/puppet/autosign.conf</code></pre></noscript></div>


<h2>Getting new instances to connect to the master</h2>

<p>The last piece of the puzzle. Since we use Ubuntu, we could simply use the <a href="http://alestic.com/2009/04/official-ubuntu-ec2">Canonical-supplied AMIs</a>. These support <a href="http://alestic.com/2009/06/ec2-user-data-scripts">user-data scripts</a> that are executed as root once the system boots. Below is a simple script that does this:</p>

<ol>
<li>Update the instance</li>
<li>Add the &#8220;puppet&#8221; entry to DNS - puppet expects the master to be accessible via &#8220;puppet&#8221; DNS resolution. This little snippet gets the current IP of the master via our DNS name and writes it to /etc/hosts</li>
<li>Install &amp; enable puppet and voila!</li>
</ol>


<div><script src='https://gist.github.com/747614.js?file=start_puppet.sh'></script>
<noscript><pre><code>#!/bin/bash

set -e -x

# Needed so that the aptitude/apt-get operations will not be interactive
export DEBIAN_FRONTEND=noninteractive

apt-get update &amp;&amp; apt-get -y upgrade 

# Find the current IP of the puppet master and make &quot;puppet&quot; point to it
puppet_master_ip=$(host my_puppet_master.company.com | grep &quot;has address&quot; | head -1 | awk '{print $NF}')
echo $puppet_master_ip puppet &gt;&gt; /etc/hosts

aptitude -y install puppet 

# Enable the puppet client
sed -i /etc/default/puppet -e 's/START=no/START=yes/'

service puppet restart</code></pre></noscript></div>


<p>Once all of this is up and running, creating a new instance is as easy as:</p>

<pre><code>ec2-run-instances -g puppets --user-data-file start_puppet.sh -t m1.small -k key-pair ami-a403f7cd
</code></pre>

<p>Happy puppeting!</p>

<p>You should subscribe to my <a href="http://feeds.feedburner.com/TheCodeDump">feed</a> and follow me on <a href="http://twitter.com/avivby">twitter</a>!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/12/18/adding-goos-sauce-to-gwt-mvp/">Adding GOOS Sauce to GWT MVP</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-18T18:06:29+02:00" pubdate data-updated="true">Dec 18<span>th</span>, 2010</time>
        
         | <a href="/2010/12/18/adding-goos-sauce-to-gwt-mvp/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For a few months now I&#8217;ve been using <a href="http://code.google.com/webtoolkit/">Google Web Toolkit</a>. One thing that was bothering me was that even when following the praised MVP (Model-View-Presenter) pattern as per the documentation, you pretty quickly get into messy land.</p>

<p>Here&#8217;s a snippet from the official GWT MVP <a href="http://code.google.com/webtoolkit/articles/mvp-architecture.html">tutorial</a>:</p>

<div><script src='https://gist.github.com/746606.js?file=gistfile1.java'></script>
<noscript><pre><code>public void bind() {
    display.getSaveButton().addClickHandler(
        new ClickHandler() {
        @Override public void click(ClickEvent e) {
            // Magic happens here
        }
    });
}</code></pre></noscript></div>


<p>In this example, you see that our Presenter, when bound, registers a click handler for a button, in order to perform some action when it is called. This might seem nice and all, but there&#8217;s a smell. This is a violation of the <a href="http://en.wikipedia.org/wiki/Law_of_Demeter">Law of Demeter</a> (the missing SOLID rule, one might say).  This simply makes it harder to test, since we now have to add another layer of indirection between the SUT and its collaborators. Instead of making the view a tiny bit smarter, we use it as a dumb collection of widgets the presenter manages. This is clearly not in &#8220;Tell, don&#8217;t ask&#8221; form.</p>

<p>The thing that really bothers me is how coupled the presenter gets with its view. Take the above example, and say that you decided that it would be better to have two &#8220;save&#8221; buttons on the UI. Does the presenter really care? Should it even change? And what if you actually want the save button to change to a remove button when the user picked something? Should the presenter now deal with getSaveOrRemoveButton() ? Of course not.</p>

<h3>GOOS it up</h3>

<p>After beating around this bush for quite some time, I decided to try and find a better way. I&#8217;m currently reading the brilliant Growing Object Oriented Software book, and decided to try its approach to push a better implementation. After a bit of refactoring I got this:</p>

<div><script src='https://gist.github.com/746606.js?file=gistfile2.java'></script>
<noscript><pre><code>public void bind() {
     display.addSaveClickHandler(new ClickHandler() {
         @Override public void click(ClickEvent e) {
             // Magic happens here
         }
     });
}</code></pre></noscript></div>


<p><a href="http://www.amazon.com/gp/product/0321503627?ie=UTF8&amp;tag=thcodu02-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0321503627"><img src="/images/posts_images/goos.jpg" style="float: right;"/></a></p>

<p>This might seem like a tiny change. And it is. But it makes all the difference in the world in how more responsive your design gets, especially in our world where the view is most likely to change a dozen times before settling on something. Once there are enough of these, I push the presenter as a dependency into the view, and let it call the presenter directly. The funny thing is this style is actually implicitly mentioned in the <a href="http://code.google.com/webtoolkit/articles/mvp-architecture-2.html">second part</a> of the GWT MVP tutorial. Just some GOOSing helped us get to a better, more malleable design!</p>

<p>Don&#8217;t be afraid to do something differently than the documentation, especially if you gave it a fair shot and it didn&#8217;t work out.</p>

<p>You should subscribe to my <a href="http://feeds.feedburner.com/TheCodeDump">feed</a> and follow me on <a href="http://twitter.com/avivby">twitter</a>!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/12/17/notes-from-the-5th-israeli-software-craftsmanship-meeting/">Notes from the 5th Israeli Software Craftsmanship Meeting</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-17T11:28:07+02:00" pubdate data-updated="true">Dec 17<span>th</span>, 2010</time>
        
         | <a href="/2010/12/17/notes-from-the-5th-israeli-software-craftsmanship-meeting/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This week I had the pleasure to attend to the 5th meeting of our Software Craftsmanship group, and boy what a meeting it was. For the first time we&#8217;ve tried a different format that is 100% hands-on and reduced someone-talking-with-slides time to a minimum.</p>

<p>The meeting was composed of 3 tables: a code review table where people actually brought code from home/work and discussed about with others, a TDD table where a veteran TDDer talked people through a Kata and a third table, led by yours truly, that aimed to introduce people to the concept of DRY and tackling some duplications problems.</p>

<p>Unfortunately for me, this means I couldn&#8217;t take part in the other tables, but from what I could pick up I must say it was really fun getting so much positive feedback for a meeting.</p>

<p>The DRY table consisted of a Kata I&#8217;ve composed specifically to raise issues of duplication already a few minutes into it, which you can find <a href="/2010/12/11/serializer-kata-practicing-dry/">here</a>. It was amazing seeing people keep working on the Kata after the 1-hour dedicated to it was up, and I never expected to see such variety (Java, C#, Python, Ruby, JavaScript and PHP were all spotted)!</p>

<p>The slides from my (extremely) short introduction to DRY are available here:</p>

<script src="http://speakerdeck.com/embed/4f6dac1faa99e4002202a486.js"></script>


<p>You should subscribe to <a href="http://feeds.feedburner.com/TheCodeDump">my</a> feed and follow me on <a href="http://twitter.com/avivby">twitter</a>!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/12/11/serializer-kata-practicing-dry/">Serializer Kata: Practicing DRY</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-11T19:46:14+02:00" pubdate data-updated="true">Dec 11<span>th</span>, 2010</time>
        
         | <a href="/2010/12/11/serializer-kata-practicing-dry/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This kata is intended to help one practice the DRY principle (Don&#8217;t Repeat Yourself). You can read more about DRY <a href="/category/dry/">here</a>.</p>

<p>A few notes:</p>

<ul>
<li>After completing a step in the Kata and before moving on to the next, take the time to make sure your code&#8217;s duplication ≤ 0</li>
<li>For the sake of focus, you may ignore matters of character escaping, encoding, error handling, object graph cycles and the likes</li>
<li>Our focus is on <strong>reducing duplication</strong>, it is <strong>not finishing</strong> the kata</li>
</ul>


<p>In this Kata, our goal is to implement 2 simple object serializers. One serializer is to <a href="http://en.wikipedia.org/wiki/XML">XML</a>, the other is to <a href="http://en.wikipedia.org/wiki/JSON">JSON</a>.</p>

<ol>
<li>Support serializing  a class without any members

<ol>
<li>To XML: EmptyClass -> &lt;EmptyClass&gt;&lt;/EmptyClass&gt;</li>
<li>To JSON: EmptyClass -> {}</li>
</ol>
</li>
<li>Add support for serializing a class&#8217; integer members

<ol>
<li>To XML: IntClass(a=1, b=2) -> &lt;IntClass&gt;&lt;a&gt;1&lt;/a&gt;&lt;b&gt;2&lt;/b&gt;&lt;/IntClass&gt;</li>
<li>To JSON: IntClass(a=1, b=2) -> { &#8220;a&#8221;: 1, &#8220;b&#8221;: 2 }</li>
</ol>
</li>
<li>Add support for serializing a class&#8217; string members

<ol>
<li>To XML: StrClass(a=&#8221;first&#8221;, b=&#8221;second&#8221;) -> &lt;StrClass&gt;&lt;a&gt;first&lt;/a&gt;&lt;b&gt;second&lt;/b&gt;&lt;/StrClass&gt;</li>
<li>To JSON: StrClass(a=&#8221;first&#8221;, b=&#8221;second&#8221;) -> { &#8220;a&#8221;: &#8220;first&#8221;, &#8220;b&#8221;: &#8220;second&#8221; }</li>
</ol>
</li>
<li>Add support for serializing a class&#8217; other class members

<ol>
<li>To XML: CompositeClass(inner=(a=1)) -> &lt;CompositeClass&gt;&lt;inner&gt;&lt;a&gt;1&lt;/a&gt;&lt;/inner&gt;&lt;/CompositeClass&gt;</li>
<li>To JSON: CompositeClass(inner=(a=1)) -> { &#8220;inner&#8221;: { &#8220;a&#8221;: 1 } }</li>
</ol>
</li>
</ol>


<p>If you found this interesting subscribe to my <a href="http://feeds.feedburner.com/TheCodeDump">feed</a> and follow me on <a href="http://twitter.com/avivby">twitter</a>!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/11/24/liskov-substitution-principle-violation-spotted-in-the-wild/">Liskov Substitution Principle Violation Spotted in the Wild</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-24T22:35:30+02:00" pubdate data-updated="true">Nov 24<span>th</span>, 2010</time>
        
         | <a href="/2010/11/24/liskov-substitution-principle-violation-spotted-in-the-wild/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The <a href="http://en.wikipedia.org/wiki/Liskov_substitution_principle">Liskov Substitution Principle</a> (LSP) states that &#8220;if S is a subtype of T, then objects of type T in a program may be replaced with objects of type S without altering any of the desirable properties of that program.&#8221; This principle is actually so important it&#8217;s part of <a href="http://en.wikipedia.org/wiki/Solid_(object-oriented_design">SOLID</a>).</p>

<p>At my work we&#8217;ve just wasted quite some time chasing down a bug that was due to a violation of LSP, in the JDK! Everyone knows the Set collection, which simply makes sure the collection can&#8217;t contain the same object twice (&#8220;same&#8221; as defined by Java&#8217;s &#8220;equals&#8221;). Set itself is unordered, which can be bumming, but fortunately the JDK people were nice enough to add SortedSet.</p>

<p>Given LSP, one might assume that wherever you use a Set you can simply replace it with a SortedSet in order to get the same thing but with sorted output. Well, think again! <em>(Tam, tam, tammmm)</em></p>

<p>Suppose you have this nice class:</p>

<div><script src='https://gist.github.com/714291.js?file='></script>
<noscript><pre><code>public class Account {
    private final String name;
    private final int id;
    public Account(String name, int id) {
        this.name = name;
        this.id = id;
    }
    public int getId() { return id; }
    public String getName() { return name; }
    @Override public int hashCode() {
        // Standard implementation with &quot;name&quot; &amp; &quot;id&quot;
    }
    @Override public boolean equals(Object obj) {
        // Standard implementation with &quot;name&quot; &amp; &quot;id&quot;
    }
}
</code></pre></noscript></div>


<p>This is all very fine and dandy, but somewhere in our code we wanted to replace a Set of Accounts with a SortedSet, so the accounts will be displayed sorted by their names (only their names). So, we whipped up this simple Comparator:</p>

<div><script src='https://gist.github.com/714332.js?file='></script>
<noscript><pre><code>Comparator&lt;Account&gt; NAME_COMPARATOR = new Comparator&lt;Account&gt;() {
    @Override public int compare(Account a1, Account a2) {
        if (a1.name == null) {
            if (a2.name == null) {
                return 0;
            }
            return -1;
        }
        return a1.name.compareTo(a2.name);
    }
};</code></pre></noscript></div>


<p>This looked very cool and everything worked, until we attempted to add to the SortedSet 2 accounts with the same name but different IDs. We expected both to be inserted to it, since they are not &#8220;equal&#8221;, but were surprised by the result of this:</p>

<div><script src='https://gist.github.com/714338.js?file='></script>
<noscript><pre><code>public class AccountTest {
    @Test public void contains() throws Exception {
        SortedSet&lt;Account&gt; set = new TreeSet&lt;Account&gt;(Account.NAME_COMPARATOR);
        Account first = new Account(&quot;first&quot;, 1);
        set.add(first);
    
        Account otherFirst = new Account(&quot;first&quot;, 2);
        assertFalse(set.contains(otherFirst));
    }
}</code></pre></noscript></div>


<p>The above test <strong>fails</strong>. After much digging and debugging, we realized that the TreeSet uses the Comparator to determine whether the account was in the set. Once it found an object in the set that had the same &#8220;comparison value&#8221; (&#8220;compareTo&#8221; returned zero), it decided the account was already in the set. This is stupidly stupid, since we felt the natural behavior is that returning zero means we don&#8217;t really care about these objects&#8217; order, and that equals() will be used to determine which are actual duplicates. Switching the code to use a non-SortedSet (e.g. HashSet) makes the test pass.</p>

<p>This violation of LSP has caused us much frustration and wasted efforts. Making me feel even worse, we found out after the fact this is <a href="http://bit.ly/g72jlQ">documented behavior</a>:</p>

<blockquote><p>The behavior of a sorted set <em>is </em>well-defined even if its ordering is inconsistent with equals; it just fails to obey the general contract of the Set interface.</p></blockquote>

<p><strong>Edit: </strong>So, yeah, had we read this beforehand we would have known this. The problem is we shouldn&#8217;t have to read it. Some commenters helped out and said we can simply make our Comparator look at &#8220;id&#8221;. Indeed we can, but this is a simplified case. In cases the object&#8217;s &#8220;equals&#8221; looks at all members, even private ones, how will you be able to provide just a comparator to sort them by a specific attribute that is public? The behavior of SortedSet means you simply can&#8217;t, making the whole point of having pluggable Comparators a a bit misleading, since most of them will have to re-implement &#8221;equals&#8221;. Indeed, the docs for Comparator#compare (as opposed to Comparable#compareTo) <strong>recommend</strong> an ordering that is consistent with equals(), but sometimes that&#8217;s just not possible. In those cases, it turns out, one can&#8217;t sort!</p>

<p>To that, all I&#8217;ve got to say is &#8220;shame on you!&#8221;</p>

<p>You should subscribe to my <a href="http://feeds.feedburner.com/TheCodeDump">feed</a> and follow me on <a href="http://twitter.com/avivby">twitter</a>!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/11/14/say-no-to-null-checks/">Say No to Null Checks</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-14T22:23:01+02:00" pubdate data-updated="true">Nov 14<span>th</span>, 2010</time>
        
         | <a href="/2010/11/14/say-no-to-null-checks/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hey, do you check your methods&#8217; arguments to make sure they&#8217;re not null?</p>

<p>Today, I got into a little discussion with a teammate about testing contracts of methods: should we check for null in every public method?</p>

<p>I was against it, and he was for it.</p>

<p>The simple reasons to do it are, first, that it makes your code more defensive. You fail explicitly instead of failing implicitly when the code tries to dereference the null object. Another argument was that given 20 callers of an interface, it&#8217;s easier to test in the interface for the precondition than to test each and every one of the callers. And, of course, that it is better API implementation, and that even if a class isn&#8217;t part of one&#8217;s public API now it might very well become part of it in the future, so why not add the tests now?</p>

<p>I&#8217;ll tackle these all. First, I have to agree that some null checks are required, at the boundaries of your system. I believe a system should have a paranoid barrier, before it everything is as suspect as someone going on a bus with a heavy coat on a hot day - that&#8217;s just waiting to blow. Once you&#8217;ve passed the barrier you know things are secure and no longer need to be paranoid.</p>

<p>So yes, some null checks are of course required.</p>

<p>But, because we want our API to be user-friendly and error-proof does that mean we need to make every public method in our code paranoid just in case it will become part of the public API at some point? 5 letters: YAGNI! :)</p>

<p>The interesting part is the testing of the callers. I agree, if we have to write the test 20 times for each caller, it will get tedious. But we don&#8217;t write the same thing twice, do we? As good old J.B Rainsberger <a href="http://blog.thecodewhisperer.com/post/207374113/who-tests-the-contract-tests">teaches</a>, what we actually need are collaboration tests. Each of the callers collaborate with the interface. And so, we create a collaboration test that makes sure the user is using the interface according to the contract. These are usually abstract tests that require us to create derivatives that implement a factory method for creating the calling class. This way we write the tests only once and make explicit the interface and contract, even in dynamic language.</p>

<p>In general, this is a powerful solution, that solves a basic problem with defensive programming. Say we do test for nullity wherever possible, what do we do then? Our system is likely to crash or throw an exception any way, since what is the interface to do? Obviously something is wrong if we were called in a way that doesn&#8217;t match the contract, so is the hassle worth it? I think testing for nullity everywhere is a thing of the past, especially once you adopt dynamic programming and get used to the fact that most of the times you can&#8217;t even be sure the object you&#8217;ve got will answer the methods you&#8217;re about to use, so what difference does a null check make?</p>

<p>So let&#8217;s write some awesome collaboration tests tests and get cracking!</p>

<p>You should subscribe to my <a href="http://feeds.feedburner.com/TheCodeDump">feed</a> and follow me on <a href="http://twitter.com/avivby">twitter</a>!</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page/5/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/page/3/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Aviv Ben-Yosef</h1>
  <img src="https://api.twitter.com/1/users/profile_image?screen_name=avivby&amp;size=original" width="128" height="128" style="height: 128px; width: 128px; border-radius: 6px">
  <p>An aspiring software craftsman and a happy hacker. More <a href="/about">about me</a>.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/03/07/slides-from-the-how-billguard-does-mongodb-talk/">Slides from the &#8220;How BillGuard does MongoDB&#8221; Talk</a>
      </li>
    
      <li class="post">
        <a href="/2012/03/01/notes-from-the-agile-practitioners-2012-improving-your-tdd-workshop/">Notes from the Agile Practitioners 2012 Improving Your TDD Workshop</a>
      </li>
    
      <li class="post">
        <a href="/2012/02/28/notes-from-the-israeli-software-craftsmanship-group-code-retreat/">Notes from the Israeli Software Craftsmanship Group Code Retreat</a>
      </li>
    
      <li class="post">
        <a href="/2012/02/04/extend-your-toolbox-custom-matchers/">Extend Your Toolbox: Custom Matchers</a>
      </li>
    
      <li class="post">
        <a href="/2012/01/28/stop-bitching-do-self-agile/">Stop Bitching: Do Self-Agile</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("avivby", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/avivby" class="twitter-follow-button" data-show-count="false">Follow @avivby</a>
  
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Aviv Ben-Yosef -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'codelord';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
